mvn archetype:generate -DgroupId=com.example -DartifactId=csv-api -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false



import org.apache.commons.csv.CSVFormat;
import org.apache.commons.csv.CSVParser;
import org.apache.commons.csv.CSVRecord;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.web.reactive.function.BodyInserters;
import org.springframework.web.reactive.function.client.WebClient;

import java.io.FileReader;
import java.io.FileWriter;
import java.io.Reader;

@SpringBootApplication
public class CsvApiApplication implements CommandLineRunner {

    private static final String CSV_FILE_PATH = "input.csv";
    private static final String OUTPUT_CSV_FILE_PATH = "output.csv";
    private static final String API_URL = "https://example.com/api"; // Replace with your actual API URL
    private static final String USERNAME = "your_username";
    private static final String PASSWORD = "your_password";

    private final WebClient webClient;

    public CsvApiApplication(WebClient.Builder webClientBuilder) {
        this.webClient = webClientBuilder
                .baseUrl(API_URL)
                .defaultHeader(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE)
                .defaultHeader(HttpHeaders.AUTHORIZATION, "Basic " + getBasicAuth())
                .build();
    }

    private String getBasicAuth() {
        String credentials = USERNAME + ":" + PASSWORD;
        return java.util.Base64.getEncoder().encodeToString(credentials.getBytes());
    }

    @Override
    public void run(String... args) throws Exception {
        Reader reader = new FileReader(CSV_FILE_PATH);
        CSVParser csvParser = new CSVParser(reader, CSVFormat.DEFAULT);

        FileWriter fileWriter = new FileWriter(OUTPUT_CSV_FILE_PATH);
        CSVFormat csvFormat = CSVFormat.DEFAULT.withHeader("ID", "Name", "Response");

        csvParser.forEach(record -> {
            // Read data from CSV
            String id = record.get("ID");
            String name = record.get("Name");

            // Create JSON request payload as a string
            String jsonRequest = "{\n" +
                    // ... (same as before)

            // Make POST API call using WebClient
            String apiResponse = webClient.post()
                    .body(BodyInserters.fromValue(jsonRequest))
                    .retrieve()
                    .bodyToMono(String.class)
                    .block(); // Block until the response is received

            // Write data to the output CSV
            try {
                fileWriter.writeRecord(id, name, apiResponse);
            } catch (Exception e) {
                e.printStackTrace();
            }
        });

        fileWriter.close();
        csvParser.close();
    }

    public static void main(String[] args) {
        SpringApplication.run(CsvApiApplication.class, args);
    }
}







import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.reactive.function.client.WebClient;

@Configuration
public class WebClientConfig {

    @Bean
    public WebClient.Builder webClientBuilder() {
        return WebClient.builder();
    }

    @Bean
    public CsvApiApplication csvApiApplication(WebClient.Builder webClientBuilder) {
        return new CsvApiApplication(webClientBuilder.build());
    }
}





